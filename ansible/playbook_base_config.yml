---

  - name: Configuration minimale des VM Linux
    hosts: all

    tasks:

    - name: Installation de paquets
      apt:
        pkg:
        - vim
        - htop
        - git
      when: ansible_facts['os_family'] == "Debian"
      become: yes      

    - name: Installation de paquets
      dnf:
        name:
          - vim
          - git
        state: present
      when: ansible_facts['os_family'] == "RedHat"
      become: yes

    - name: Copie du fichier de configuration de vim
      copy:
        src: vimrc
        dest: /home/antonin/.vimrc

    - name: Copie du fichier de configuration de bash
      copy:
        src: bashrc
        dest: /home/antonin/.bashrc
      when: ansible_facts['os_family'] == "Debian"

    - name: Ajout d'antonin au groupe wheel
      ansible.builtin.user:
        name: antonin
        group: wheel
      when: ansible_facts['os_family'] == "RedHat"
      become: yes

    - name: Suppresion de la demande de mot de passe pour sudo (Debian groupe sudo)
      ansible.builtin.lineinfile:
        path: /etc/sudoers
        state: present
        regexp: '^%sudo ALL='
        line: '%sudo ALL=(ALL) NOPASSWD: ALL'
        validate: /usr/sbin/visudo -cf %s
      when: ansible_facts['os_family'] == "Debian"
      become: yes

    - name: Suppresion de la demande de mot de passe pour sudo (CentOS groupe wheel)
      ansible.builtin.lineinfile:
        path: /etc/sudoers
        state: present
        regexp: '^%wheel ALL='
        line: '%wheel ALL=(ALL) NOPASSWD: ALL'
        validate: /usr/sbin/visudo -cf %s
      when: ansible_facts['os_family'] == "RedHat"
      become: yes